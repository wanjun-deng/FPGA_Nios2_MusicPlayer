# Nios II 音乐播放器 (软件控制版)

本项目是一个基于 Altera Nios II 软核处理器的 FPGA 音乐播放器。通过将乐谱逻辑从硬件 ROM 转移到软件 C 数组，实现了更灵活的播放控制和丰富的功能。

## 核心功能
- **四种播放模式**: 单次播放、单曲循环、顺序播放、随机播放。
- **多源控制**: 支持 4x4 矩阵键盘和 NEC 协议红外遥控器同步控制。
- **实时调节**: 4 级音量调节 (PWM 实现) 和 4 级播放速度调节。
- **状态显示**: 8 位数码管实时显示歌曲编号、模式、音量、速度、当前音符及最后按键值。
- **架构优化**: 采用模块化设计 (Player, InputManager) 和中断驱动计时 (Timer ISR)。

## 硬件架构
- **FPGA**: Cyclone IV E
- **处理器**: Nios II (Fast)
- **外设**:
  - FreqSynth: 自定义频率合成器 (Verilog)
  - Key_Board: 矩阵键盘扫描模块
  - ir_decode: 红外接收解码模块
  - HEX8: 8 位数码管驱动模块
  - PIO: 用于 Nios II 与硬件模块通信

## 软件模块
- `main.c`: 程序入口，负责系统初始化和主循环调度。
- `player.c/h`: 播放引擎，管理播放状态机 (FSM) 和切歌逻辑。
- `input_manager.c/h`: 输入抽象层，统一键盘和红外事件。
- `ir_handler.c/h`: 红外底层处理与数码管显示格式化。
- `config.h`: 系统全局配置常量。
- `score_data.h`: 乐谱数据数组。

## 使用说明
1. 使用 Quartus II 编译硬件工程并下载 `.sof` 文件。
2. 在 Nios II Software Build Tools 中生成 BSP 并编译软件。
3. 运行软件，通过键盘或红外遥控器进行操作。

### 按键映射
- **0-3**: 切换播放模式
- **4**: 暂停/继续
- **5**: 停止
- **6-9**: 切换歌曲 1-4
- **10/UP**: 音量+
- **11/DOWN**: 音量-
- **12/RIGHT**: 速度+
- **13/LEFT**: 速度-
